{% comment %}
  ** Grid de Coleções Horizontal Otimizado **
  - Com rolagem horizontal fluida (scroll-snap).
  - Hover opcional.
  - Título sobreposto ou abaixo, configurável.
  - Responsivo e leve.
  - Usa proporção nativa com aspect-ratio.
{% endcomment %}

<div class="custom-collection-grid-section" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
  <div class="page-width">
    {% if section.settings.title != blank %}
      <div class="custom-collection-grid__header" style="text-align: {{ section.settings.heading_alignment }};">
        <h2 class="custom-collection-grid__title">{{ section.settings.title | escape }}</h2>
      </div>
    {% endif %}

    <div class="custom-collection-grid__scroll-wrapper">
      <ul class="custom-collection-grid__list" style="gap: {{ section.settings.gap_size }}px;">
        {%- for block in section.blocks -%}
          {%- assign collection = block.settings.collection -%}
          {%- assign image = block.settings.image | default: collection.image | default: collection.products.first.featured_image -%}
          {%- assign title_override = block.settings.title_override -%}
          {%- assign item_title = title_override | default: collection.title | default: 'Coleção' -%}
          {%- assign collection_url = collection.url | default: '#' -%}

          <li class="custom-collection-grid__item" {{ block.shopify_attributes }} style="border-radius: {{ section.settings.border_radius }}px;">
            <a href="{{ collection_url }}" class="custom-collection-grid__item-link">
              <div class="custom-collection-grid__image-wrapper" style="aspect-ratio: {{ section.settings.image_ratio }};">
                {% if image %}
                  {{ image | image_url: width: 600 | image_tag:
                    loading: 'lazy',
                    class: 'custom-collection-grid__image',
                    widths: '150, 200, 300, 400, 500, 600'
                  }}
                {% else %}
                  {{ 'collection-apparel' | placeholder_svg_tag: 'custom-collection-grid__image placeholder' }}
                {% endif %}

                {% unless section.settings.show_title_always %}
                  {% if section.settings.show_title_overlay %}
                    <div class="custom-collection-grid__item-title overlay">
                      {{ item_title }}
                    </div>
                  {% endif %}
                {% endunless %}
              </div>

              {% if section.settings.show_title_always %}
                <div class="custom-collection-grid__item-title static" style="color: {{ section.settings.text_color_static_title }}">
                  {{ item_title }}
                </div>
              {% endif %}
            </a>
          </li>
        {%- endfor -%}
      </ul>
    </div>
  </div>
</div>

<style>
  .custom-collection-grid__title {
    font-size: 24px;
    color: #F2F2F2;
    margin-bottom: 24px;
  }

  .custom-collection-grid__scroll-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    margin: 0 -10px;
    padding: 0 10px;
  }

  .custom-collection-grid__scroll-wrapper::-webkit-scrollbar {
    display: none;
  }

  .custom-collection-grid__list {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    scroll-snap-type: x mandatory;
  }

  .custom-collection-grid__item {
    flex: 0 0 auto;
    width: auto;
    scroll-snap-align: start;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    background-color: transparent;
  }

  .custom-collection-grid__item:hover {
    {% if section.settings.enable_hover_effect %}
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    {% endif %}
  }

  .custom-collection-grid__item-link {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: inherit;
    height: 100%;
  }

  .custom-collection-grid__image-wrapper {
    width: 100%;
    position: relative;
    background-color: #eee;
    border-radius: inherit;
  }

  .custom-collection-grid__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: inherit;
    display: block;
  }

  .custom-collection-grid__item-title.overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.5);
    color: #fff;
    padding: 8px;
    font-size: 14px;
    text-align: center;
  }

  .custom-collection-grid__item-title.static {
    font-size: 14px;
    text-align: center;
    padding: 10px 4px;
  }

  @media screen and (max-width: 749px) {
    .custom-collection-grid__title {
      font-size: 20px;
    }

    .custom-collection-grid__item-title.static {
      font-size: 13px;
    }
  }
</style>

{% schema %}
{
  "name": "Grid Coleções",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título da Seção",
      "default": "Nossas Coleções"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Alinhamento do Título",
      "options": [
        { "value": "left", "label": "Esquerda" },
        { "value": "center", "label": "Centro" },
        { "value": "right", "label": "Direita" }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Proporção da Imagem",
      "options": [
        { "value": "0.6666", "label": "Retrato (2:3)" },
        { "value": "0.75", "label": "Retrato (3:4)" },
        { "value": "1", "label": "Quadrado (1:1)" },
        { "value": "1.3333", "label": "Paisagem (4:3)" },
        { "value": "1.5", "label": "Paisagem (3:2)" }
      ],
      "default": "1"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Raio da Borda dos Itens (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "gap_size",
      "label": "Espaçamento entre Itens (px)",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "Título do Item"
    },
    {
      "type": "checkbox",
      "id": "show_title_overlay",
      "label": "Mostrar título sobre a imagem (ao passar o mouse)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_title_always",
      "label": "Mostrar título sempre (abaixo da imagem)",
      "default": false
    },
    {
      "type": "color",
      "id": "text_color_static_title",
      "label": "Cor do Texto (título sempre visível)",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Efeitos e Estilo"
    },
    {
      "type": "checkbox",
      "id": "enable_hover_effect",
      "label": "Ativar efeito de flutuar ao passar o mouse",
      "default": true
    },
    {
      "type": "header",
      "content": "Espaçamento da Seção"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Espaçamento Superior",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Espaçamento Inferior",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "collection_block",
      "name": "Bloco de Coleção",
      "limit": 12,
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Coleção"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagem Personalizada"
        },
        {
          "type": "text",
          "id": "title_override",
          "label": "Título Personalizado"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Grid Coleções",
      "blocks": [
        { "type": "collection_block" },
        { "type": "collection_block" },
        { "type": "collection_block" },
        { "type": "collection_block" }
      ]
    }
  ]
}
{% endschema %}