{%- assign gap_desktop = section.settings.card_gap -%}
{%- assign cards_desktop = section.settings.cards_desktop -%}
{%- assign gap_tablet = section.settings.card_gap -%}
{%- assign cards_tablet = section.settings.cards_tablet -%}
{%- assign gap_mobile = section.settings.card_gap -%}
{%- assign cards_mobile = section.settings.cards_mobile -%}

{%- case section.settings.card_size -%}
  {%- when 'small' -%}
    {%- assign card_size = '120px' -%}
  {%- when 'medium' -%}
    {%- assign card_size = '160px' -%}
  {%- when 'large' -%}
    {%- assign card_size = '200px' -%}
{%- endcase -%}

<style>
  #shopify-section-{{ section.id }} {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  #shopify-section-{{ section.id }} .colecoes-wrapper {
    display: flex;
    gap: {{ gap_desktop }}px;
    padding-bottom: 10px;
  }
  #shopify-section-{{ section.id }} .colecao-card {
    flex-shrink: 0;
    width: {{ card_size }};
    text-align: center;
    box-sizing: border-box;
  }
  #shopify-section-{{ section.id }} .colecao-card img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: {{ section.settings.card_radius }}px;
  }
  #shopify-section-{{ section.id }} .colecao-card p {
    margin-top: 6px;
    font-size: 14px;
    text-align: center;
  }
  .colecoes-title {
    text-align: center;
    font-size: 24px;
    margin-bottom: 16px;
  }

  /* Tablet */
  @media (max-width: 1024px) {
    #shopify-section-{{ section.id }} .colecao-card {
      width: calc((100vw - {{ gap_tablet | times: cards_tablet | minus: gap_tablet }}px) / {{ cards_tablet }});
    }
  }

  /* Mobile */
  @media (max-width: 600px) {
    #shopify-section-{{ section.id }} .colecao-card {
      width: calc((100vw - {{ gap_mobile | times: cards_mobile | minus: gap_mobile }}px) / {{ cards_mobile }});
    }
  }
</style>

<section id="shopify-section-{{ section.id }}" class="colecoes-section">
  {%- if section.settings.title != blank -%}
    <h2 class="colecoes-title">{{ section.settings.title }}</h2>
  {%- endif -%}

  <div class="colecoes-wrapper">
    {%- for block in section.blocks -%}
      {%- assign collection = block.settings.collection -%}
      <a href="{{ collection.url }}" class="colecao-card">
        {% if block.settings.image %}
          <img
            srcset="
              {{ block.settings.image | img_url: '200x' }} 200w,
              {{ block.settings.image | img_url: '400x' }} 400w,
              {{ block.settings.image | img_url: '600x' }} 600w
            "
            sizes="(max-width: 600px) 80vw, (max-width: 1024px) 40vw, 200px"
            src="{{ block.settings.image | img_url: '400x' }}"
            alt="{{ collection.title | escape }}"
            loading="lazy"
          />
        {% elsif collection.featured_image %}
          <img
            srcset="
              {{ collection.featured_image | img_url: '200x' }} 200w,
              {{ collection.featured_image | img_url: '400x' }} 400w,
              {{ collection.featured_image | img_url: '600x' }} 600w
            "
            sizes="(max-width: 600px) 80vw, (max-width: 1024px) 40vw, 200px"
            src="{{ collection.featured_image | img_url: '400x' }}"
            alt="{{ collection.title | escape }}"
            loading="lazy"
          />
        {% else %}
          <div style="width: 100%; height: {{ card_size }}; background: #eee; display: flex; align-items: center; justify-content: center;">No image</div>
        {% endif %}
        <p>{{ collection.title }}</p>
      </a>
    {%- endfor -%}
  </div>
</section>

{% schema %}
{
  "name": "Coleções Horizontal",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título da seção",
      "default": "Nossas Coleções"
    },
    {
      "type": "select",
      "id": "card_size",
      "label": "Tamanho dos cards",
      "options": [
        { "value": "small", "label": "Pequeno" },
        { "value": "medium", "label": "Médio" },
        { "value": "large", "label": "Grande" }
      ],
      "default": "medium"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "Borda arredondada (px)",
      "min": 0,
      "max": 50,
      "step": 2,
      "default": 12
    },
    {
      "type": "range",
      "id": "cards_desktop",
      "label": "Cards por linha (Desktop)",
      "min": 1,
      "max": 8,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "cards_tablet",
      "label": "Cards por linha (Tablet)",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "cards_mobile",
      "label": "Cards por linha (Mobile)",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "Espaçamento entre cards (px)",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 10
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Coleção",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Coleção"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagem personalizada (opcional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Coleções Horizontal",
      "category": "Collections",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}